<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Create and Manage Blueprints for Edge Images :: Building Red Hat Device Edge Images</title>
    <link rel="prev" href="s5-blueprint.html">
    <link rel="next" href="s7-compose.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Red Hat Device Edge Images</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Red Hat Device Edge Images</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-devices.html">Introduction to Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-images.html">Design, Build, and Publish Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-install-lab.html">Lab: Install Image Builder on a Development Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-blueprint.html">Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s7-compose.html">Create Edge Images as Image Builder Composes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s8-compose-lab.html">Lab: Create and Manage Composes for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s9-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-publish/index.html">Publish Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s1-ostree.html">Introduction to OSTree Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s2-ostree-lab.html">Lab: Create a Remote OSTree Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s3-pull-local-lab.html">Lab: Publish Edge Images on Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s4-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-test/index.html">Test Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s1-boot.html">Validate and Test Edge Images Using Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-update/index.html">Update Edge Devices with New Operating System Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s1-deltas.html">Apply, and Rollback Updates to Edge Devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s2-update-lab.html">Lab: Create And Publish Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s3-rollback-lab.html">Lab: Rollback Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s4-deltas-lab.html">Lab: Update Edge Devices Using Static Deltas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Red Hat Device Edge Images</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Red Hat Device Edge Images</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Red Hat Device Edge Images</a></li>
    <li><a href="index.html">Build Operating System Images for Edge Devices</a></li>
    <li><a href="s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Create and Manage Blueprints for Edge Images</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>5 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Create, validate, and update Image Builder blueprints for building edge images.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a <em>development machine</em> with RHEL and configured with the Image Builder service, its CLI and web UI, and a user that is a member of the <code>weldr</code> group. Make sure your development machine is configured and verified by following the instructions from the <a href="s4-install-lab.html" class="xref page">previous lab</a>.</p>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 9.5 but should work with minimal or no change on newer and older RHEL 9.x releases.</p>
</div>
<div class="paragraph">
<p>If you are using the course classroom, you will log in on the <code>workstation</code> VM as the user <code>student</code> with password <code>student</code>. If not, please adapt the instructions to your test environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the Image Builder service is active and your Linux user can submit requests to it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli status show</strong>
API server status:
    Database version:   0
    Database supported: true
    Schema version:     0
    API version:        1
    Backend:            osbuild-composer
    Build:              NEVRA:osbuild-composer-118-1.el9.x86_64
...</code></pre>
</div>
</div>
</li>
<li>
<p>Create a minimal blueprint for an edge device and upload it to the Image Builder service.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a minimal blueprint for a RHEL 9 server in text mode. This blueprint includes no application, on purpose.</p>
<div class="paragraph">
<p>Use your preferred text editor to create the <code>rhel9-edge.toml</code> file with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">name = "rhel9-edge"
description = "blueprint-rhel9-edge"
version = "0.1.0"
modules = [ ]
groups = [ ]

[customizations]
hostname = "edge"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <a href="https://github.com/RedHatQuickCourses/rhde-build-samples/blob/main/blueprints/rhel9-edge.toml">minimal blueprint</a> from the sample applications repository in GitHub.</p>
</div>
</li>
<li>
<p>Upload the blueprint to Image Builder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints push rhel9-edge.toml</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the blueprint exists in the Image Builder service storage. Notice that it has no record of the original file name, you identify blueprints by their <code>name</code> attributes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints list</strong>
rhel9-edge</code></pre>
</div>
</div>
</li>
<li>
<p>You can also show the contents of the blueprint as stored in the Image Builder service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints show rhel9-edge</strong>
name = "rhel9-edge"
description = "blueprint-rhel9-edge"
version = "0.1.0"
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Validate that Image Builder service can resolve all dependencies from the blueprint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints depsolve rhel9-edge</strong>
blueprint: rhel9-edge v0.0.1
    acl-2.3.1-4.el9.x86_64
    alternatives-1.24-1.el9_5.1.x86_64
    audit-libs-3.1.5-1.el9.x86_64
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of packages is very long, even for minimal blueprints. It is important to check that there are no error messages in the output, which would indicate an error in the configuration of RPM repositories configured on the Image Builder service on your <em>developer machine</em>.</p>
</div>
</li>
<li>
<p>Change the blueprint to add an Apache Web Server. Suppose that your original intent was to include a web server as the application on this blueprint, but forgot to do so.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Download the blueprint from the Image Builder service to the <code>rhel9-httpd.toml</code> file.</p>
<div class="paragraph">
<p>You could make changes directly to your local file, or grab the original file from version control, but we get it from the Image Builder Service just to show how it can be done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints save rhel9-edge --filename rhel9-httpd.toml</strong></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Red Hat does NOT recommend that you use Image Builder as the source of truth for blueprints, but only as a temporary storage. Red Hat recommends that you keep your blueprints under version control, using Git or similar software.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use your preferred text editor to change the <code>rhel9-httpd.toml</code> file as follows. Make sure you do NOT change its <code>name</code> attribute!</p>
<div class="paragraph">
<p>Add services and firewall customizations, so the service is readily available on the device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">name = "rhel9-edge"
description = "blueprint-rhel9-edge"
version = "0.1.0"
modules = []
groups = []
distro = ""

[[packages]]
name = "httpd"

[customizations]
hostname = "edge"

[customizations.services]
enabled = ["sshd", "httpd"]

[customizations.firewall.services]
enabled = ["ssh", "http"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <a href="https://github.com/RedHatQuickCourses/rhde-build-samples/blob/main/blueprints/rhel9-httpd.toml">changed version of the blueprint</a> from the sample applications repository in GitHub.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Upload and validate the changed blueprint. It is not sufficient to make changes to the local file copy of the blueprint, you must send the changes to Image Builder so you can create images with your changes.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>First, verify that the current blueprint in the Image Builder service does NOT include the Apache Web Server packages.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints depsolve rhel9-edge | grep httpd</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Upload the changed blueprint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints push rhel9-httpd.toml</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify the blueprint now includes the Apache Web Server.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints depsolve rhel9-edge | grep httpd</strong>
    httpd-2.4.62-1.el9.x86_64
    httpd-core-2.4.62-1.el9.x86_64
...</code></pre>
</div>
</div>
</li>
<li>
<p>If you made a mistake in a value such as a package name, when you changed the blueprint, the pipe to <code>grep</code> would <strong>NOT</strong> hide error messages. But if you made a mistake in the syntax of the TOML file, you will get an error message during the push operation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints push rhel9-edge.toml</strong>
ERROR: BlueprintsError: 400 Bad Request: The browser (or proxy) sent a request that this server could not understand: toml: line 6 (last key "packages"): type mismatch for blueprint.Package: expected table but found string</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, fix your file and upload the blueprint again.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now you know the basics of managing blueprints with the Image Builder service.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next activity builds an edge commit image from the blueprint you just created, and later in this course, you will use that image to provision virtual edge devices.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s5-blueprint.html">Create and Manage Blueprints for Edge Images</a></span>
  <span class="next"><a href="s7-compose.html">Create Edge Images as Image Builder Composes</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
