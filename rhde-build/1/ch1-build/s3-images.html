<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Design, Build, and Publish Edge Images :: Building Red Hat Device Edge Images</title>
    <link rel="prev" href="s2-devices-quiz.html">
    <link rel="next" href="s4-install-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Red Hat Device Edge Images</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Red Hat Device Edge Images</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-devices.html">Introduction to Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s3-images.html">Design, Build, and Publish Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-install-lab.html">Lab: Install Image Builder on a Development Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-blueprint.html">Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s7-compose.html">Create Edge Images as Image Builder Composes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s8-compose-lab.html">Lab: Create and Manage Composes for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s9-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-publish/index.html">Publish Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s1-ostree.html">Introduction to OSTree Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s2-ostree-lab.html">Lab: Create a Remote OSTree Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s3-pull-local-lab.html">Lab: Publish Edge Images on Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s4-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-test/index.html">Test Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s1-boot.html">Validate and Test Edge Images Using Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-test/s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-update/index.html">Update Edge Devices with New Operating System Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s1-deltas.html">Apply, and Rollback Updates to Edge Devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s2-update-lab.html">Lab: Create And Publish Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s3-rollback-lab.html">Lab: Rollback Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s4-deltas-lab.html">Lab: Update Edge Devices Using Static Deltas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Red Hat Device Edge Images</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Red Hat Device Edge Images</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Red Hat Device Edge Images</a></li>
    <li><a href="index.html">Build Operating System Images for Edge Devices</a></li>
    <li><a href="s3-images.html">Design, Build, and Publish Edge Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Design, Build, and Publish Edge Images</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>6 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Understand the generic workflows for building and publishing RHEL for Edge system images.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending SME Review &amp; Proofreading
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provision_and_update_edge_devices_with_image_builder_and_rpm_ostree"><a class="anchor" href="#_provision_and_update_edge_devices_with_image_builder_and_rpm_ostree"></a>Provision and Update Edge Devices with Image Builder and RPM-OSTree</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Image Builder service is the main tool to create RHEL for Edge system images, which it calls edge images. There are multiple ways of using those images to provision and update edge devices, and the following figure gives an overview of the general workflow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s3-images-fig-1.svg" alt="s3 images fig 1">
</div>
<div class="title">Figure 1. Edge device installation and update workflows</div>
</div>
<div class="paragraph">
<p>Image Builder takes as input a blueprint, which describes the operating system and application components to include in the system image, such as RPM packages from RHEL, RPM packages from third-party DNF repositories, and container images.</p>
</div>
<div class="paragraph">
<p>Image Builder outputs a system image which, in the case of an edge system image, is an <strong>OSTree commit</strong> produced by RPM-OSTree.</p>
</div>
<div class="paragraph">
<p>You can use the OSTree commit as-is, and copy (or push) it to a remote OSTree repository in a standard web server. Then the standard RHEL installer, with a custom kickstart file, can download and deploy the OSTree commit into an edge device.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can provide a second blueprint to Image Builder, which refers to the OSTree repository, to build a bootable installation image which embeds the OSTree commit. That custom installation image is self-sufficient to boot and install an edge device without access to a remote web server.</p>
</div>
<div class="paragraph">
<p>The same bootable installation images could be used with a standard PXE or UEFI network boot server, which usually is an edge server.</p>
</div>
<div class="paragraph">
<p>Regardless of how an edge device was originally provisioned, edge device updates must follow the same workflow: the device downloads a new OSTree commit from a remote web server. You must copy (or push) the update images from Image Builder a that web server, so that edge devices can fetch the new image and update themselves.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_rhel_image_builder_service"><a class="anchor" href="#_the_rhel_image_builder_service"></a>The RHEL Image Builder Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Image Builder runs as a system service in RHEL, named <strong>osbuild-composer</strong>. Image Builder needs elevated system privileges to manipulate SELinux labels and other attributes in files that belong to a system image, but unprivileged users can interact with it safely using one of its clients. You don&#8217;t need root privilege to build system images with the Image Builder service. You only need file system access to its UNIX socket file, which is allowed to the <code>weldr</code> group.</p>
</div>
<div class="paragraph">
<p>Unlike other similar services, such as the Docker daemon, Image Builder has a limited scope of operations, which ensures that access to the Image Builder service does not allow its users to circumvent system security to perform privileged operations. Access to Image Builder does <strong>not</strong> make a user a "root equivalent" and does not create any significant security risks.</p>
</div>
<div class="paragraph">
<p>The biggest benefit of using Image Builder, compared to generic Anaconda or Ansible automation, is the built-in knowledge about the needs of multiple target platforms such as cloud providers and hypervisors. It ensures your image contains all recommended settings and system services for working well on each platform. That applies to both traditional, package-based images and edge images.</p>
</div>
<div class="paragraph">
<p>Depending on the target environment and the type of image, you can use different methods to perform additional installation-time (or day-1) customization of new systems, for device or site-specific configurations. Anaconda Kickstart and CoreOS Ignition are among the supported alternatives. Or you could build your own workflow for adding local customizations to an image, for example by using an interactive application which runs during the first boot.</p>
</div>
<div class="paragraph">
<p>Image Builder can also generate edge images for cloud edge platform such as AWS Outposts. Those images are still based on RPM-OSTree image but use the cloud service formats, for example AWS AMI; they support cloud provider agents, such as AWS System Manager; and also cloud provider configuration services, for example Cloud-Init for AWS.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_image_builder_clients"><a class="anchor" href="#_image_builder_clients"></a>Image Builder Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three ways of interacting with the Image Builder service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using its command-line client, the <code>composer-cli</code> command.</p>
</li>
<li>
<p>Using the web UI of the Composer Cockpit module.</p>
</li>
<li>
<p>Using the <code>osbuild</code> Ansible collection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Later on this course we learn the details of using each of these interfaces to the Image Builder service.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_edge_device_updates_with_rpm_ostree"><a class="anchor" href="#_edge_device_updates_with_rpm_ostree"></a>Edge Device Updates with RPM-OSTree</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You don&#8217;t interact directly with RPM-OSTree to build edge system images, this is the job of the Image Builder service. But you must use the RPM-OSTree tooling to manage edge devices themselves.</p>
</div>
<div class="paragraph">
<p>Edge devices use RPM-OSTree to download system image updates, as new OSTree commits, and deploy them as the active system image for the next boot. System administrators must log in manually on each edge device and use the RPM-OSTree tooling, more specifically the <code>rpm-ostree</code> command, to fetch and deploy updates or to rollback an update and return to the previous system system image, or automate those operations using Ansible.</p>
</div>
<div class="paragraph">
<p>As you would expect, all edge system images produced by Image Builder are hard-coded to include the RPM-OSTree tooling, so that edge devices can be updated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ostree_repository_management"><a class="anchor" href="#_ostree_repository_management"></a>OSTree Repository Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you build a system image with the Image Builder service, no matter if it&#8217;s the initial image for provisioning an edge device or if it&#8217;s an update image for existing devices, you must publish the image, that is, its OSTree commit, on a remote OSTree repository, so that edge devices can fetch it.</p>
</div>
<div class="paragraph">
<p>You either use OSTree repository management commands to copy (or push) the OSTree commit, or you automate that process publishing edge images using Ansible.</p>
</div>
<div class="paragraph">
<p>Your development system, which you use to build and test RHEL for Edge system images, must include the OSTree tooling, so you can publish images and updates to remote OSTree repositories, in addition to the Image Builder service and its clients. More specifically, you need the <code>ostree</code> command.</p>
</div>
<div class="paragraph">
<p>Once you automate provisioning and updates of edge devices using Ansible, it makes sense to also automate edge image creation and publishing using Ansible, so that you have an end-to-end, automated process, for building and deploying edge system images. Ideally, you would integrate that automation with the CI/CD system that builds applications you run on your edge devices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you was introduced to the essential concepts and tools of RHEL for Edge, a series of hands-on activities install and configure Image Builder, RPM-OStree, and OSTree in a development system, which you use to build simple edge images. Later in this course you will publish those images in a web server, test those edge images using local VMs, and them update those VMs to use newer system images.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a></span>
  <span class="next"><a href="s4-install-lab.html">Lab: Install Image Builder on a Development Machine</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
