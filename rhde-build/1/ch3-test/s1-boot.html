<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developement Testing of Edge Images :: Building Red Hat Device Edge Images</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-boot-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Red Hat Device Edge Images</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Red Hat Device Edge Images</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-build/index.html">Build Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s1-devices.html">Introduction to Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s3-images.html">Design, Build, and Publish Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s4-install-lab.html">Lab: Install Image Builder on a Development VM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s5-blueprint.html">Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s7-compose.html">Create Edge Images as Image Builder Composes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s8-compose-lab.html">Lab: Create and Manage Composes for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s9-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-publish/index.html">Publish Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s1-ostree.html">Introduction to OSTree Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s2-ostree-lab.html">Lab: Create a Remote OSTree Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s3-pull-local-lab.html">Lab: Publish Edge Images on Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s4-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Test Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-boot.html">Developement Testing of Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-boot-lab.html">Lab: Boot Edge VMs from Remote OSTree Repostories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-installer-lab.html">Lab: Boot Edge VMs from Edge Installer Images OSTree</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-update/index.html">Update Edge Devices with New Operating System Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s1-deltas.html">Apply, and Rollback Updates to Edge Devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Red Hat Device Edge Images</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Red Hat Device Edge Images</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Red Hat Device Edge Images</a></li>
    <li><a href="index.html">Test Operating System Images for Edge Devices</a></li>
    <li><a href="s1-boot.html">Developement Testing of Edge Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Developement Testing of Edge Images</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>11 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Understand how to provision edge devices from OSTree repositories and edge instaler images.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Work In Progress
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_edge_devices"><a class="anchor" href="#_provisioning_edge_devices"></a>Provisioning Edge Devices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you publish an edge commit image on a remote OSTree repository you can provision edge systems.</p>
</div>
<div class="paragraph">
<p>You can use the standard RHEL installation media, together with a small custom kickstart file, to provision edge systems directly from a remote OSTree repository:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-boot-fig-1.svg" alt="s1 boot fig 1">
</div>
<div class="title">Figure 1. End of an edge device installation workflow the standard RHEL installation media</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the Image Builder service to create an edge installer image, which embeds an OSTree commit, and copy the generated edge installer image to an USB media. Then you provision edge systems using the edge installer image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-boot-fig-2.svg" alt="s1 boot fig 2">
</div>
<div class="title">Figure 2. End of an edge device installation workflow an edge installer image and custom boot media</div>
</div>
<div class="paragraph">
<p>There&#8217;s a third alternative, which we do not cover in this course: you can use Image Builder to create an edge cloud image, which embeds an OSTree commit, and upload that image to a cloud provider. Then you provision edge cloud instances using the edge cloud image.</p>
</div>
<div class="paragraph">
<p>The two alternatives described here can be used with either PXE or UEFI network boot. The details will be presented by a future course. Here we focus on testing our edge images by provision local virtual machines using the KVM technology fgrom RHEL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types_of_edge_installer_images"><a class="anchor" href="#_types_of_edge_installer_images"></a>Types of Edge Installer Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Image Builder service can produce two kinds of edge installer images:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Edge installer image</dt>
<dd>
<p>It is a custom RHEL installation media, using the Anaconda installation program as the standard installation media, and which includes a kickstart file that points to an OSTree commit embedded into the installation media itself. You can further customize its kickstart file, if you wish, to include different installation-time customizations.</p>
</dd>
<dt class="hdlist1">Simplified edge Installer image</dt>
<dd>
<p>It is a custom RHEL CoreOS installation media, which includes a raw disk image, and the raw disk image includes an already deployed OSTree commit. The RHEL CoreOS installation program just copies the raw image into the root disk, without allowing further customizations. You can provide first-boot customizations using the Ignition technology.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The kickstart technology should be known to Red Hat Enterprise Linux system administrators, and Red Hat OpenShift administrators will recognize ignition from its use provisioning OpenShift cluster node and configurations for the OpenShift Machine Configuration operator.</p>
</div>
<div class="paragraph">
<p>There&#8217;s some overlap between customizations that could be specified in an Image Builder blueprint, a RHEL kickstart file, or a CoreOS ignition configuration. Red Hat recommends that you use blueprint customizations as much as possible, reserving kickstart and ignition customizations for things you wish to change in an individual edge device or edge site basis. Also consider if other kinds of automation, sich as Red Hat Ansible Automation Platform, may be best suited for applying customizations as a day-2 activity instead of as a installation or first boot basis.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_edge_installer_images"><a class="anchor" href="#_creating_edge_installer_images"></a>Creating Edge Installer Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process for creating an edge installer image (or its simplified counterpart) requires a minmal blueprint. There are a few customizations that you could include in that blueprint, such as defining Linux users and groups, but most other customizations, and any attempt at including package information, will fail the compose.</p>
</div>
<div class="paragraph">
<p>The compose for edge installer images (and also for edge simplified images) requires two arguments which point to a remote OSTree repository and to an OSTree commit inside that repository.</p>
</div>
<div class="paragraph">
<p>The Image Builder service pulls the OSTree commit and includes it in the edge installer image, which can be used to provision edge systems without network access to the remote OSTree repository. This is not intended for true disconnected deployments, but to enable provisioning edge devices with low bandwidth, high latency, or intermitent network connectivity. Remember that edge devices require access to a remote OSTree repository to fetch system updates.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_system_layout_of_edge_systems"><a class="anchor" href="#_file_system_layout_of_edge_systems"></a>File System Layout of Edge Systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>[ Not sure this belongs here&#8230;&#8203; maybe have a shorter presentation to mention /sysroot and defer most to the update chapter ]</p>
</div>
<div class="paragraph">
<p>Just so you have an idea of what to expect in a RHEL for Edge system, after it boots, let&#8217;s describe the RPM-OSTree file system layout. Unlike package-based systems, which provide choice of using multiple disk devices and partitions, LVM technology, and mounting those disk devices at different directories, RPM-OSTree requires a fixed file system layout with a read-only <code>/usr</code> folder, to ensure the pristine state of the operating system as booted from its system image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-boot-fig-3.svg" alt="s1 boot fig 3">
</div>
<div class="title">Figure 3. RPM-OSTree file system layout</div>
</div>
<div class="paragraph">
<p>The root disk of an RPM-OSTree system contains an OSTree repository with a deployed branch. That branch is mounted (chroot) as the root filesystem and the actual root disk is available at <code>/sysroot</code> for operations such as feching system updates and installing new boot loaders from those updates.</p>
</div>
<div class="paragraph">
<p>An RPM-OSTree system has only two writeable file systems: <code>/etc</code> and <code>/var</code>, so you can customize system configurations and store application data on edge devices. Later in this course we will learn how those directories are treated during system updates.</p>
</div>
<div class="paragraph">
<p>Many other top-level directories, which would be writeable, are actually symlinks to a directory under <code>/var</code>. For example, <code>/home</code> is a symlink to <code>/var/home</code> and <code>/usr/local</code> is a synlink to <code>/var/usrlocal</code>.</p>
</div>
<div class="paragraph">
<p>RPM-OSTree expects that there&#8217;s nothing on <code>/</code> other than mountpoints and synlinks. All operating system binaries are actually under <code>/usr</code> and older system directories are symlinks to directories under <code>/usr</code>. For example, <code>/bin</code> is a symlink to <code>/usr/bin</code>.</p>
</div>
<div class="paragraph">
<p>RPM-OSTree also enables activating a write file system layer over <code>/usr</code> for local customizations, for example to install aditional RPM packages not included in the system image. In that case, you must install packages using the <code>rpm-ostree</code> command, because the <code>dnf</code> command would attempt to write to the RPM database in the system image, which is read-only.</p>
</div>
<div class="paragraph">
<p>Note: It is not expected that production edge systems make use of the RPM-OSTree capability of installing additional packages, but it can be handy during development and troubleshooting of edge images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rpm_ostree_deployment_and_edge_system_provisioning"><a class="anchor" href="#_rpm_ostree_deployment_and_edge_system_provisioning"></a>RPM-OSTree Deployment and Edge System Provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An edge device could pull multiple OSTree commits, but only one of those commits is active, or <strong>deployed</strong>. Deploying an OSTree commit with RPM-OSTree also installs the boot loader, kernel, and initrd from the files insinde the commit.</p>
</div>
<div class="paragraph">
<p>When provisioning an edge system, OSTree deployment can happen in different moments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At installation time, when using the standard RHEL installation media: the standard RHEL installer creates an empty OSTree repository on the root disk, pulls an OSTree commit from a remote OSTree repository, and deploys the commit;</p>
</li>
<li>
<p>At at installation, when using an edge installer image: the standard RHEL installer copies the OSTree repository from the installation media itself to the system root disk, and deploys the only commit in that repository.</p>
</li>
<li>
<p>At image build time, when using a simplified edge installer image: the simplified edge installer image contains a raw system image which an OSTree repository containing a single, already deployed, OSTree commit, and just copies that raw system image to the system boot disk, then it installs the boot loader, kernel, and initrd from the raw system image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a system boots into an OSTree deployment, you can pull updates, as a new OSTree commits, from a remote OSTree repository to its local OSTree repository branch and deploy the new OSTree commit. The update process, which we see in details later in this course, does not change based on how the system was initially provisioned.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_booting_vms_in_text_mode"><a class="anchor" href="#_booting_vms_in_text_mode"></a>Booting VMs In Text Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RHEL includes the Libvirt technology, which offers command-line tools and Cockpit modules for managing KVM kernel virtual machines with the Qemu emulation and paravirtualization layer. It is the same virtualization technology used by other Red Hat products, such as Red Hat OpenStack Platform, Red Hat Virtualization, and Red Hat OpenShift Virtualization.</p>
</div>
<div class="paragraph">
<p>Libvirt VMs provide a quick way of testing edge system images, either on a development machine, or on a CI/CD server. If your edge application requires special hardware, it is possible to provide emulation or pass-through physical devices to the VM.</p>
</div>
<div class="paragraph">
<p>Common usage of Libvirt mimics booting a physical system: you get a BIOS boot screen, can switch the boot device, and monitor the installation and first boot processes. It requires using either a graphical desktop or the Cockpit web UI to interact with the virtual console of a VM.</p>
</div>
<div class="paragraph">
<p>If using an edge commit image and standard RHEL installation media, you would edit the Grub menu to add a reference to a kickstart file, which requires interactice access to the VM console. But you can make this process completely automated and non-interactice by setting a few VM creation options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A location boot source, instead of a virtual CD-ROM drive.</p>
</li>
<li>
<p>A reference to a kickstart file in a web server.</p>
</li>
<li>
<p>A virtual serial console, instead of the default virtual graphics console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options must be used together: you cannot add custom kernel argument to enable a serial console and a kickstart file if using a virtual CD-ROM drive.</p>
</div>
<div class="paragraph">
<p>Virtual serial consoles offer a few of advantages for testing and development:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ability to acesss VM consoles from a command-prompt, such as an SSH session.</p>
</li>
<li>
<p>The entire boot process can be run in remote, headless servers. You don&#8217;t need a GUI desktop nor an active and interactive web session.</p>
</li>
<li>
<p>All boot messages can be recorded in a text file, using standard I/O redirections, which saves disk space and enables text searches during troubleshooting failed installation attempts, compared to recording virtual desktop sessions from a graphic console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[ revalidate the following statement ]</p>
</div>
<div class="paragraph">
<p>Unfortunately, simplified installer images require the use of a graphical console, because they require VMs configured for UEFI boot. You can still create VMs using simplified installer images unattended, but you will need a GUI sesson or Cockpit to access the console of a VM for monitoring and troubleshooing.</p>
</div>
<div class="paragraph">
<p>In this course, we use Libvirt VMs to test our edge images as a convenience. Nothing prevents the use of other hypervisor technologies and cloud instances. You just need to know how to provide to these VMs a suitable boot source, and there&#8217;s also the alternative of using an edge cloud image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you about installing RHEL systems from OSTree commits and the usage of edge installer images, a series of hands-on activities provision VMs using different methods and edge images, and the final chapter shows how to update those VMs to new system images.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Test Operating System Images for Edge Devices</a></span>
  <span class="next"><a href="s2-boot-lab.html">Lab: Boot Edge VMs from Remote OSTree Repostories</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
