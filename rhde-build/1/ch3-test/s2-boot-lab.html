<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Boot Test VMs from Remote OSTree Repositories :: Building Red Hat Device Edge Images</title>
    <link rel="prev" href="s1-boot.html">
    <link rel="next" href="s3-installer-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Red Hat Device Edge Images</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Red Hat Device Edge Images</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-build/index.html">Build Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s1-devices.html">Introduction to Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s3-images.html">Design, Build, and Publish Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s4-install-lab.html">Lab: Install Image Builder on a Development Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s5-blueprint.html">Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s7-compose.html">Create Edge Images as Image Builder Composes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s8-compose-lab.html">Lab: Create and Manage Composes for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s9-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-publish/index.html">Publish Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s1-ostree.html">Introduction to OSTree Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s2-ostree-lab.html">Lab: Create a Remote OSTree Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s3-pull-local-lab.html">Lab: Publish Edge Images on Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s4-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Test Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-boot.html">Validate and Test Edge Images Using Virtual Machines</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-update/index.html">Update Edge Devices with New Operating System Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s1-deltas.html">Apply, and Rollback Updates to Edge Devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s2-update-lab.html">Lab: Create And Publish Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s3-rollback-lab.html">Lab: Rollback Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s4-deltas-lab.html">Lab: Update Edge Devices Using Static Deltas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Red Hat Device Edge Images</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Red Hat Device Edge Images</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Red Hat Device Edge Images</a></li>
    <li><a href="index.html">Test Operating System Images for Edge Devices</a></li>
    <li><a href="s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repositories</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Boot Test VMs from Remote OSTree Repositories</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>9 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Boot a test VM from an OSTree commit in a remote OSTree repository.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending SME Review &amp; Proofreading
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a <em>development machine</em> with RHEL and configured with the Image Builder service, its CLI and web UI, and a user that is a member of the <code>weldr</code> group. Make sure that your development machine was configured and verified by following the instructions from the <a href="../ch1-build/s4-install-lab.html" class="xref page">first lab</a>.</p>
</div>
<div class="paragraph">
<p>You also need a <em>web server machine</em> which serves an OSTree repository. Make sure that machine was configured and verified by following the instructions from <a href="../ch2-publish/s2-ostree-lab.html" class="xref page">a previous lab</a>.</p>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 9.4 [tentative!] but should work with minimal or no change on newer and older RHEL 9.x releases.</p>
</div>
<div class="paragraph">
<p>If you are using the course classroom, you will log in on the <code>workstation</code> VM as the user <code>student</code> with password <code>student</code>, and you start SSH sessions to the <code>servera</code> VM from the same user. If not, please adapt the instructions to your test environment.</p>
</div>
<div class="paragraph">
<p>You will perform most steps in this lab alternating between your <em>development machine</em> and your <em>web server machine</em>. You will also perform a few steps from a <em>test VM</em> that you will create as part of this lab.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On your <em>development machine</em>, verify that you have the prerequisites from previous labs.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify that the Image Builder service is active and that the current Linux user can submit requests to it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli status show</strong>
API server status:
    Database version:   0
    Database supported: true
    Schema version:     0
    API version:        1
    Backend:            osbuild-composer
    Build:              NEVRA:osbuild-composer-76-2.el9_2.x86_64
...</code></pre>
</div>
</div>
</li>
<li>
<p>Check that you can get the current commit ID the OSTree branch with the httpd edge system image that you created in <a href="../ch2-publish/s2-ostree-lab.html" class="xref page">a previous lab</a>. You will get a different ID:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://servera.lab.example.com/repo/refs/heads/rhel/9/x86_64/edge</strong>
7ff678881e89e96c90eb083b905dce411740caf19c524481d7c1b848647b5746</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pay attention to the final path element of the URL, which should be "edge".</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On your <em>development machine</em>, install the Libvirtd tools and its Cockpit module, if they are not already installed.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Install the "Virtualization Host" package group to get the Libvirt, KVM, and Qemu daemons and tools.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo dnf group install -y "Virtualization Host"</strong>
...
Complete!
$ <strong>dnf install -y cockpit-machines</strong>
...
Complete!</code></pre>
</div>
</div>
</li>
<li>
<p>Grant an unprivileged user with permission to create and manage virtual machines (VMs).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo groupmod libvirt -a -U student</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Log off and log in again to update the user membership of your unprivileged user.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On your <em>development machine</em>, create and publish a kickstart file which points to the OSTree repository on the web server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Using your preferred text editor, create a file named <code>rhel9-httpd.ks</code> with the following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">lang en_US.UTF-8
keyboard us
timezone Etc/UTC --utc
text

zerombr
clearpart --all --initlabel
autopart --type=plain
rootpw --lock

reboot

network --bootproto=dhcp 
ostreesetup --nogpg --osname=rhel --remote=edge --url=http://servera.lab.example.com/repo/ --ref=rhel/9/x86_64/edge

%post --log=/var/log/anaconda/post-install.log --erroronfail

useradd -g wheel core
echo "core:redhat123" | chpasswd

%end</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also download the <a href="https://github.com/RedHatQuickCourses/rhde-build-samples/blob/main/ks/rhel9-httpd.ks">kickstart file</a> from sample applications repository in GitHub.</p>
</div>
<div class="paragraph">
<p>Most lines on that kickstart file can be changed according to your needs, and real-world deployments would include items such as SSH keys for remote management. There are three really important pieces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>autopart</code> command, which creates a disk partitioning scheme without using LVM. Else, your edge system would get a disk partitioning which is incompatible with RPM-OSTree and fail in a later installation stage.</p>
</li>
<li>
<p>The <code>ostreesetup</code> command, which directs Anaconda to download the latest commit from a remote OSTree repository using HTTP.</p>
</li>
<li>
<p>The <code>%post</code> block, which replaces the <code>user</code> directive in a regular kickstart file.  A <code>user</code> directive would work here but it would not for edge installer images.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the Kickstart file to your home directory on the web server machine.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>scp rhel9-httpd.ks servera.lab.example.com:~</strong>
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Switch to your <em>web sever machine</em> and publish the kickstart file in the web server content directory. This is simpler than embedding the kickstart file in the RHEL installation media or creating a virtual disk to use only for creating VMs.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Copy the kickstart file to the web server content directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ls -1</strong>
7ff678881e89e96c90eb083b905dce411740caf19c524481d7c1b848647b5746-commit.tar
rhel9-httpd.ks
$ <strong>sudo cp rhel9-httpd.ks /var/ww/html</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the kickstart file is accessible to the <code>apache</code> user and has correct SELinux labels.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ls -lZ /var/www/html</strong>
total 5
drwxr-xr-x. 7 root root unconfined_u:object_r:httpd_sys_content_t:s0 102 Sep  6 18:07 repo
-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 317 Sep  6 18:07 rhel9-httpd.ks</code></pre>
</div>
</div>
</li>
<li>
<p>If you need, change file permissions and SELinux labels.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo chmod -R a+X /var/www/html</strong>
$ <strong>sudo restorecon -R /var/www/html</strong></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Back to your <em>development machine</em>, verify that a remote client can access the kickstart file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://servera.lab.example.com/rhel9-httpd.ks</strong>
lang en_US.UTF-8
keyboard us
timezone Etc/UTC --utc
...</code></pre>
</div>
</div>
</li>
<li>
<p>Still on your <em>development machine</em>, create a <em>test VM</em> which boots from the RHEL installation ISO and fetches an edge commit image from a web server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Download the standard <a href="https://access.redhat.com/downloads/content/rhel">RHEL installation ISO</a> from the customer portal, from <a href="https://developers.redhat.com/products/rhel/download#getredhatenterpriselinux7163">Red Hat Developers</a>, or download a copy in the classroom environment at [TBD]. Choose either the Network Install Image or the RHEL Server ISO for a smaller download. You do <strong>NOT</strong> need an Offline Install Image.</p>
<div class="paragraph">
<p>Ensure you have a complete and consistent RHEL installation ISO in the <code>/home/student/Downloads/rhel-9.4-x86_64-boot.iso</code> file before proceeding.</p>
</div>
</li>
<li>
<p>Create a local VM, with a serial console and direct kernel loading, which uses the kickstart file from the previous steps.</p>
<div class="paragraph">
<p>The following is a long command, it is broken into multiple lines for readability. [ REVIEW for RHEL 9.4 ]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virt-install --name edge-test-1 --os-variant rhel9.2 \
--memory 4096 --vcpus 2 --disk size=20 --graphics=none \
--location /home/student/Downloads/rhel-9.4-x86_64-boot.iso \
--extra-arg inst.ks=http://servera.lab.example.com/rhel9-httpd.ks \
--extra-arg console=ttyS0 -v</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are used to managing Libvirt VMs using Cockpit, feel free to perform VM creation and other tasks using its web UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must use <code>--location</code> instead of <code>--cdrom</code> to be able to pass kernel arguments with <code>--extra-args</code>. Else you will be required to use the Grub menu, interactively, to add a reference to the kickstart file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Wait until the installation finishes and you get a login prompt on the VM. It is expected that the VM reboots once during its installation. Log in as user <code>core</code> with password <code>redhat123</code>. [ review for  RHEL 9.4 ]</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Red Hat Enterprise Linux 9.2 (Plow)
Kernel 5.14.0-284.11.1.el9_2.x86_64 on an x86_64

edge login: <strong>core</strong>
Password:
[core@edge ~]$</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On your <em>test VM</em>, check it is an image-based system using RPM-OStree.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <code>rpm-ostree</code> command to see its deployed branch and commit.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>rpm-ostree status</strong>
State: idle
Deployments:
● edge:rhel/9/x86_64/edge
                  Version: 9.2 (2024-09-06T22:07:45Z)
                   Commit: 7ff678881e89e96c90eb083b905dce411740caf19c524481d7c1b848647b5746</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the commit ID you see matches the one from the <code>curl</code> command at the beginning of this lab.</p>
</div>
</li>
<li>
<p>You can get similar information from the <code>ostree</code> command, using its default system repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>ostree refs</strong>
edge:rhel/9/x86_64/edge
ostree/0/1/0
[core@edge ~]$ <strong>ostree log rhel/9/x86_64/edge</strong>
commit 7ff678881e89e96c90eb083b905dce411740caf19c524481d7c1b848647b5746
ContentChecksum:  549eb067bbcfa59a90f1948e75702a34a857122a74d9936c062bc64349f24330
Date:  2024-09-06 22:07:45 +0000
Version: 9.2
(no subject)</code></pre>
</div>
</div>
</li>
<li>
<p>Also, notice that the local OSTree repository connects to a remote repository on the web server machine.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>ostree remote list --show-urls</strong>
edge  http://servera.lab.example.com/repo/</code></pre>
</div>
</div>
</li>
<li>
<p>Check also the location of the local OSTree repository in <code>/sysroot</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ ostree refs --repo=/sysroot/ostree/repo
ostree/0/1/0
edge:rhel/9/x86_64/db</code></pre>
</div>
</div>
</li>
<li>
<p>Take the opportunity to familiarize yourself with the file system layout of an RPM-OSTree system and the multiple bind mounts on the root disk.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>df -h | grep vda</strong>
/dev/vda3        35G  1.6G   34G   5% /sysroot
/dev/vda1       960M  145M  816M  16% /boot
[core@edge ~]$ <strong>mount | grep vda</strong>
/dev/vda3 on /sysroot type xfs (ro,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda3 on / type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda3 on /etc type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda3 on /usr type xfs (ro,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda3 on /sysroot/ostree/deploy/rhel/var type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda3 on /var type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
/dev/vda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On the <em>test VM</em>, verify that there is an Apache Web Server running.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check that the <code>httpd</code> Systemd service is enabled and active</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>systemctl is-active httpd</strong>
active</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the Apache Web Server inside the VM returns the standard welcome page from RHEL.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge ~]$ <strong>curl 127.0.0.1</strong>
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
        &lt;head&gt;
                &lt;title&gt;Test Page for the HTTP Server on Red Hat Enterprise Linux&lt;/title&gt;
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Return to your <em>developer machine</em>, and optionally stop your <em>test VM</em>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not delete (undefine) your <em>test VM</em>, you will use it during the next chapter to perform system updates.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Detach from the serial console of the VM by typing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>]</kbd></span>.</p>
<div class="paragraph">
<p>Later you can reattach a VM serial console using the <code>virsh console</code> command.</p>
</div>
</li>
<li>
<p>Optionally, stop the <em>test VM</em>. You will still use that VM in a future lab, when we apply updates to edge images.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh destroy edge-test-1</strong>
Domain 'edge-test-1' destroyed
$ <strong>virsh list --all</strong>
 Id   Name          State
---------------------------
 1    edge-test-1   shut-off</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>destroy</code> verb of the <code>virsh</code> command does not actually "destroys" a VM. It only stops the VM, which can be restarted at any time with the <code>virsh start</code> command. What it actually destroys is the running kernel process which contains the running VM.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the VM creation fails, which could be caused by an incorrect kickstart file, stop and delete the VM before retrying the previous step.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh destroy edge-test-1</strong>
Domain 'edge-test-1' destroyed
$ <strong>virsh undefine --remove-all-storage edge-test-1</strong>
Domain 'edge-test-1' has been undefined</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You just learned how to create and check a local VM from an edge commit image that was published in a remote OSTree repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next activity builds an edge installer image and boots another local VM from it, demonstrating another method to provision edge devices.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s1-boot.html">Validate and Test Edge Images Using Virtual Machines</a></span>
  <span class="next"><a href="s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
