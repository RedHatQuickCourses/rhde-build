<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Boot Test VMs from Edge Installer Images :: Building Red Hat Device Edge Images</title>
    <link rel="prev" href="s2-boot-lab.html">
    <link rel="next" href="s5-summary.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Red Hat Device Edge Images</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Red Hat Device Edge Images</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-build/index.html">Build Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s1-devices.html">Introduction to Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s2-devices-quiz.html">Quiz: Use Cases for Edge Devices and RHEL for Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s3-images.html">Design, Build, and Publish Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s4-install-lab.html">Lab: Install Image Builder on a Development VM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s5-blueprint.html">Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s6-blueprint-lab.html">Lab: Create and Manage Blueprints for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s7-compose.html">Create Edge Images as Image Builder Composes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s8-compose-lab.html">Lab: Create and Manage Composes for Edge Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-build/s9-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-publish/index.html">Publish Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s1-ostree.html">Introduction to OSTree Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s2-ostree-lab.html">Lab: Create a Remote OSTree Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s3-pull-local-lab.html">Lab: Publish Edge Images on Remote OSTree Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-publish/s4-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Test Operating System Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-boot.html">Validate and Test Edge Images Using Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repostories</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-update/index.html">Update Edge Devices with New Operating System Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s1-deltas.html">Apply, and Rollback Updates to Edge Devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s2-update-lab.html">Lab: Create And Publish Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s3-rollback-lab.html">Lab: Rollback Edge Image Updates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-update/s4-deltas-lab.html">Lab: Update Edge Devices Using Static Deltas</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Red Hat Device Edge Images</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Red Hat Device Edge Images</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Red Hat Device Edge Images</a></li>
    <li><a href="index.html">Test Operating System Images for Edge Devices</a></li>
    <li><a href="s3-installer-lab.html">Lab: Boot Test VMs from Edge Installer Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Boot Test VMs from Edge Installer Images</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>11 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Build an edge installer image and boot a test VM from it.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending SME Review &amp; Proofreading
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a <em>development machine</em> with RHEL and configured with the Image Builder service, its CLI and web UI, and a user that is member of the <code>weldr</code> group. Make sure your development machine was configured and verified by following the instructions from the <a href="../ch1-build/s4-install-lab.html" class="xref page">first lab</a>.</p>
</div>
<div class="paragraph">
<p>You also need a <em>web server machine</em> which serves an OSTree repository. Make sure that machine was configured and verified by following the instructions from <a href="../ch2-publish/s2-ostree-lab.html" class="xref page">a previous lab</a>.</p>
</div>
<div class="paragraph">
<p>Finally, you need the database image that you created and published in <a href="../ch2-publish/s2-ostree-lab.html" class="xref page">another lab</a>.</p>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 9.4 [tentative!] but should work with minimal or no change on and newer and older RHEL 9.x releases.</p>
</div>
<div class="paragraph">
<p>If you are using the course classroom, you will log in on the <code>workstation</code> VM as the user <code>student</code> with password <code>student</code>, and you start SSH sessions to the <code>servera</code> VM from the same user. If not, please adapt the instructions to your test environment.</p>
</div>
<div class="paragraph">
<p>You will perform most steps in this lab from your <em>development machine</em>. You have no need to log in on the <em>web server</em> machine if it was prepared correctly by previous labs. You will also perform a few steps from a <em>database VM</em> that you will create as part of this lab.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that you have the prerequisites from previous labs.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify that the Image Builder service is active and that the current Linux user can submit requests to it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli status show</strong>
API server status:
    Database version:   0
    Database supported: true
    Schema version:     0
    API version:        1
    Backend:            osbuild-composer
    Build:              NEVRA:osbuild-composer-76-2.el9_2.x86_64
...</code></pre>
</div>
</div>
</li>
<li>
<p>Check that a remote client can access the OSTree repository in the web server machine.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://servera.lab.example.com/repo/config</strong>
[core]
repo_version=1
mode=archive-z2</code></pre>
</div>
</div>
</li>
<li>
<p>Check that you can get the current commit ID the OSTree branch with the httpd edge system image that you created in <a href="../ch2-publish/s3-pull-local-lab.html" class="xref page">a previous lab</a>. Your will get a different ID:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://servera.lab.example.com/repo/refs/heads/rhel/9/x86_64/db</strong>
12a22681baff58184e22ebc3e189453ed18f0984727c81311781021ccab899a1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pay attention to the final path element of the URL, which should be "db".</p>
</div>
</li>
<li>
<p>Check that you can manage local VMs, and there&#8217;s a VM left from the <a href="#s2-boot-lab:">previous lab</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh list --all</strong>
 Id   Name          State
---------------------------
 1    edge-test-1   shut-off</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s fine the existing VM displays an status of "running" instead of "shut off". You do not need the existing VM for this lab, but you will use it in a future lab.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create an edge installer image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use your preferred text editor to create a blueprint for the edge installer image, in the <code>mysql-installer.toml</code> file, with the following contents.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">name = "mysql-installer"
description = "blueprint-mysql-installer"
version = "0.0.1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also downlod the <a href="https://github.com/RedHatQuickCourses/rhde-build-samples/blob/main/blueprints/mysql-installer.toml">installer blueprint</a> from sample applications repository in GitHub.</p>
</div>
</li>
<li>
<p>Upload the blueprint to the Image Builder service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli blueprints push mysql-installer.toml</strong>
$ <strong>composer-cli blueprints list</strong>
rhel9-edge
rhel9-mysql
mysql-installer</code></pre>
</div>
</div>
</li>
<li>
<p>Build an edge installer image, using the blueprint you just uploaded, referring to the edge commit image that was published in a web server in a <a href="../ch2-publish/s3-pull-local-lab.html" class="xref page">previous lab</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli compose start-ostree mysql-installer edge-installer --ref rhel/9/x86_64/db --url http://servera.lab.example.com/repo/</strong>
Compose 7a5036e1-4037-4edc-82ff-4c632c0a84fc added to the queue</code></pre>
</div>
</div>
</li>
<li>
<p>If you use an invalid blueprint, that adds packages or defines invalid customizations to an edge installer image, you will get an error similar to the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">ERROR: ManifestCreationFailed: failed to create osbuild manifest: unsupported blueprint customizations found for boot ISO image type "edge-installer": (allowed: User, Group)</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the UUID of your compose, from the previous command, to a shell variable.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>UUID=7a5036e1-4037-4edc-82ff-4c632c0a84fc</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the compose finishes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli compose list</strong>
ID                                     Status     Blueprint         Version   Type
7a5036e1-4037-4edc-82ff-4c632c0a84fc   RUNNING    mysql-installer   0.0.1     edge-installer
01f3796b-85fd-4383-bbe8-eefc9550acdc   FINISHED   rhel9-edge        0.0.1     edge-commit
575d8ddc-2902-4de3-a0d5-82f5f194f5d8   FAILED     rhel9-edge        0.0.1     edge-commit
$ <strong>composer-cli compose list</strong>
ID                                     Status     Blueprint         Version   Type
7a5036e1-4037-4edc-82ff-4c632c0a84fc   FINISHED   mysql-installer   0.0.1     edge-installer
01f3796b-85fd-4383-bbe8-eefc9550acdc   FINISHED   mysql-edge        0.0.1     edge-commit
575d8ddc-2902-4de3-a0d5-82f5f194f5d8   FAILED     rhel9-edge        0.0.1     edge-commit</code></pre>
</div>
</div>
</li>
<li>
<p>Download the edge installer image. You should get an ISO file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>composer-cli compose image $UUID</strong>
7a5036e1-4037-4edc-82ff-4c632c0a84fc-installer.iso</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Inspect your edge installer image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Mount the ISO file in a temporary directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkdir temp-iso</strong>
$ <strong>sudo mount -o loop,ro $UUID-installer.iso temp-iso</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Check that the ISO contains an OSTree repository and a kickstart file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ls temp-iso/</strong>
EFI  images  isolinux  osbuild.ks  ostree
$ <strong>ls temp-iso/ostree/repo/</strong>
config  extensions  objects  refs  state  tmp
$ <strong>cat temp-iso/osbuild.ks</strong>
ostreesetup --osname=rhel --url=file:///run/install/repo/ostree/repo --ref=rhel/9/x86_64/db --nogpg</code></pre>
</div>
</div>
</li>
<li>
<p>Find the label of the ISO image, you will need it for the next steps. Copy the argument of the <code>-l</code> option to a shell variable</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>grep search temp-iso/EFI/BOOT/grub.cfg</strong>
search --no-floppy --set=root -l 'RHEL-9-2-0-BaseOS-x86_64'
$ <strong>LABEL=RHEL-9-2-0-BaseOS-x86_64</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Extract the ISO contents into another temporary directory</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkdir new-iso</strong>
$ <strong>sudo tar cf - -C temp-iso . | tar xf - -C new-iso</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Unmount the ISO.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo umount temp-iso</strong></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Replace the kickstart in the edge installer image with one designed for unattended installation.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify that you have the <code>mkisofs</code> command. If you don&#8217;t, install the <code>xorriso</code> package. It&#8217;s fine if have a different version than shown bellow.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkisofs --version</strong>
xorriso 1.5.4 : RockRidge filesystem manipulator, libburnia project.
...</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new kickstart file with uses the same <code>ostreesetup</code> command from the minimal kickstart file you see in the edge installer image, but adding other commands so it can run unattended. Save the new kickstart file as <code>rhel9-mysql-installer.ks</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">lang en_US.UTF-8
keyboard us
timezone Etc/UTC --isUtc
text

zerombr
clearpart --all --initlabel
autopart --type=plain
rootpw --lock
user --name=core --group=wheel --password=redhat123

reboot

network --bootproto=dhcp
ostreesetup --osname=rhel --url=file:///run/install/repo/ostree/repo --ref=rhel/9/x86_64/db --nogpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also download the contents of the <a href="https://raw.githubusercontent.com/RedHatQuickCourses/rhde-build-samples/refs/heads/main/ks/rhel9-mysql-installer.ks">new kickstart file</a> from the course samples repository in GitHub.</p>
</div>
</li>
<li>
<p>Copy your custom kickstart file over the kickstart file on the edge installer image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cp rhel9-mysql-installer.ks new-iso/osbuild.ks</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Build a new iso. If you notice that the following command specifies the <code>-no-emul-boot</code> option twice, this is <strong>not</strong> a mistake! You really need the two of them.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkisofs -o new-installer.iso -b isolinux/isolinux.bin -J -R -l -c isolinux/boot.cat \
-no-emul-boot -boot-load-size 4 -boot-info-table -eltorito-alt-boot -e images/efiboot.img -no-emul-boot \
-graft-points -joliet-long -V "$LABEL" new-iso</strong>
...
Writing to 'stdio:new-installer.iso' completed successfully.</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that your bootable ISO is compatible with UEFI firmware.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>isohybrid --uefi new-installer.iso</strong>
isohybrid: Warning: more than 1024 cylinders: 2220
isohybrid: Not all BIOSes will be able to boot this device</code></pre>
</div>
</div>
</li>
<li>
<p>Mount the new ISO in a temporary directory and check that it contains the customized kickstart file, then unmount it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo mount -o loop,ro new-installer.iso temp-iso</strong>
$ <strong>cat temp-iso/osbuild.ks</strong>
lang en_US.UTF-8
keyboard us
timezone Etc/UTC --isUtc
...
$ <strong>sudo umount temp-iso</strong></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a a <em>database VM</em> that boots from the edge installer image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a local VM using the edge installer image from previous steps. You can choose one the following:</p>
<div class="ulist">
<ul>
<li>
<p>Use a graphical boot, from a virtual CD-ROM reader.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must do this from a graphics desktop.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virt-install --name edge-db-1 --os-variant rhel9.2 --memory 4096 --vcpus 2 --disk size=40 \
--cdrom /home/student/new-installer.iso -v</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Use a virtual serial console and direct kernel loading, plus a reference the kickstart in the ISO image.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can do this from a secure shell session.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virt-install --name edge-db-1 --os-variant rhel9.2 --memory 4096 --vcpus 2 --disk size=40 \
--location /home/student/new-installer.iso --graphics=none --extra-arg console=ttyS0 \
--extra-arg inst.ks=hd:LABEL=$LABEL:/osbuild.ks -v</strong></code></pre>
</div>
</div>
</li>
<li>
<p>If you are used to managing Libvirt VMs using Cockpit, feel free to perform VM creation and other tasks using its web UI.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Wait until the installation finishes and you get a login prompt on the VM. It is expected that the VM reboots once during its installation. Log in as user <code>core</code> with password <code>redhat123</code>. [ review for  RHEL 9.4 ]</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Red Hat Enterprise Linux 9.2 (Plow)
Kernel 5.14.0-284.11.1.el9_2.x86_64 on an x86_64

edge-db login: <strong>core</strong>
Password:
[core@edge-db ~]$</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On your <em>database VM</em>, check it is an image-based system using RPM-OStree.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <code>rpm-ostree</code> command to see its deployed branch and commit.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge-db ~]$ <strong>rpm-ostree status</strong>
State: idle
Deployments:
‚óè edge:rhel/9/x86_64/db
                  Version: 9.2 (2024-09-06T22:07:45Z)
                   Commit: 12a22681baff58184e22ebc3e189453ed18f0984727c81311781021ccab899a1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the commit ID you see matches the one from the <code>curl</code> command at the beginning of this lab.</p>
</div>
</li>
<li>
<p>Verify that the local OSTree repository is <strong>not</strong> connected to a remote repository yet. You will need to configure a remote before you can update this edge VM.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge-db ~]$ <strong>ostree remote list --show-urls</strong>
rhel  file:///run/install/repo/ostree/repo</code></pre>
</div>
</div>
</li>
<li>
<p>If you wish, you can explore the file system inside the <em>database VM</em>. You should see the same mounts you already saw in the <a href="s2-boot-lab.html" class="xref page">previous lab</a>. Different types of edge images should produce the same file system layout.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On your <em>database VM</em>, check that there is a MySQL database running.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify that the <code>mysqld</code> Systemd service is enabled and active</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge-db ~]$ <strong>systemctl is-active mysqld</strong>
active</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the MySQL database inside the VM containers only the standard system databases.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge-db ~]$ <strong>sudo mysqlshow</strong>
+--------------------+
|     Databases      |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Later in this course you will update your database image to include a starter database.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Return to your <em>developer machine</em>, and optionally stop your <em>database VM</em>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not delete (<code>virsh undefine</code>) your <em>database VM</em>, you will use it during the next chapter to perform system updates.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Detach from the serial console of the VM by typing <code>Ctrl+]</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[core@edge-db ~]$ <strong>^]</strong>
$</code></pre>
</div>
</div>
</li>
<li>
<p>Optionally, stop the <em>database VM</em>. You will still use that VM in a future lab, when we apply updates to edge images.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh destroy edge-db-1</strong>
Domain 'edge-db-1' destroyed
$ <strong>virsh list --all</strong>
 Id   Name          State
---------------------------
 1    edge-test-1   shut-off
 2    edge-db-1     shut-off</code></pre>
</div>
</div>
</li>
<li>
<p>If you had issues with booting or accessing your <em>database VM</em>, please review the <a href="s2-boot-lab.html" class="xref page">previous lab</a> for Libvirt troubleshooting hints using the <code>virsh</code> command. It may also help trying a different VM creation method, for example, if you used <code>--location</code>, try using <code>--cdrom</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You just learned how to create an edge installer image and boot a test VM from an it. Notice that, unlike the <a href="s2-boot-lab.html" class="xref page">previous lab</a>, you only accessed the <em>web server machine</em> to create the edge installer image but didn&#8217;t need it to create a test VM.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The final round of activities in this course will update the system images on both local VMs, to demonstrate how to build and apply system updates to edge devices.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s2-boot-lab.html">Lab: Boot Test VMs from Remote OSTree Repostories</a></span>
  <span class="next"><a href="s5-summary.html">Summary</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
